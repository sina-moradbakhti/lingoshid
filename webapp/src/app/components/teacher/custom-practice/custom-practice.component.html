    <div class="container">
      <div class="header">
        <button (click)="goBack()" class="back-btn">‚Üê Back</button>
        <h1>Create Custom Practice</h1>
      </div>

      <div class="two-column-layout">
        <!-- Left: Create Form -->
        <div class="form-section">
          <h2>New Practice</h2>
          <form (ngSubmit)="createPractice()" class="practice-form">
            <div class="form-group">
              <label>Title *</label>
              <input type="text" [(ngModel)]="newPractice.title" name="title" required placeholder="e.g., Describe Your Favorite Food" />
            </div>

            <div class="form-group">
              <label>Description *</label>
              <textarea [(ngModel)]="newPractice.description" name="description" required rows="3" placeholder="What will students do in this activity?"></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Activity Type *</label>
                <select [(ngModel)]="newPractice.type" name="type" required (change)="onActivityTypeChange()">
                  <option value="">Select type...</option>
                  <option *ngFor="let type of activityTypes" [value]="type.value">{{ type.label }}</option>
                </select>
                <small *ngIf="newPractice.type" class="type-description">{{ getTypeDescription(newPractice.type) }}</small>
              </div>

              <div class="form-group">
                <label>Difficulty *</label>
                <select [(ngModel)]="newPractice.difficulty" name="difficulty" required>
                  <option value="">Select...</option>
                  <option *ngFor="let diff of difficultyLevels" [value]="diff.value">{{ diff.label }}</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Skill Area *</label>
                <select [(ngModel)]="newPractice.skillArea" name="skillArea" required>
                  <option value="">Select...</option>
                  <option *ngFor="let skill of skillAreas" [value]="skill.value">{{ skill.label }}</option>
                </select>
              </div>

              <div class="form-group">
                <label>Points Reward *</label>
                <input type="number" [(ngModel)]="newPractice.pointsReward" name="pointsReward" required min="5" max="50" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Min Level *</label>
                <input type="number" [(ngModel)]="newPractice.minLevel" name="minLevel" required min="1" max="10" />
              </div>

              <div class="form-group">
                <label>Max Level (Optional)</label>
                <input type="number" [(ngModel)]="newPractice.maxLevel" name="maxLevel" min="1" max="10" />
              </div>
            </div>

            <!-- Dynamic Content Fields Based on Activity Type -->
            <div *ngIf="newPractice.type" class="content-section">
              <h3>Activity Content</h3>

              <!-- Pronunciation Challenge Content -->
              <div *ngIf="newPractice.type === 'pronunciation_challenge'" class="content-fields">
                <div class="form-group">
                  <label>Instruction (Optional)</label>
                  <textarea [(ngModel)]="content.pronunciation.instruction" name="pronInstruction" rows="2"
                    placeholder="e.g., Listen carefully and repeat each word clearly"></textarea>
                </div>

                <div class="words-section">
                  <label>Words to Practice *</label>
                  <div *ngFor="let word of content.pronunciation.words; let i = index" class="word-item">
                    <div class="word-header">
                      <span class="word-number">Word {{i + 1}}</span>
                      <button type="button" (click)="removePronunciationWord(i)" class="btn-remove">√ó</button>
                    </div>
                    <div class="word-fields">
                      <input type="text" [(ngModel)]="word.word" [name]="'word_' + i" placeholder="Word" required />
                      <input type="text" [(ngModel)]="word.phonetic" [name]="'phonetic_' + i" placeholder="Phonetic (e.g., /h…ôÀàlo ä/)" required />
                      <input type="text" [(ngModel)]="word.audioUrl" [name]="'audioUrl_' + i" placeholder="Audio URL (optional)" />
                    </div>
                  </div>
                  <button type="button" (click)="addPronunciationWord()" class="btn-add">+ Add Word</button>
                </div>
              </div>

              <!-- Picture Description Content -->
              <div *ngIf="newPractice.type === 'picture_description'" class="content-fields">
                <div class="form-group">
                  <label>Instruction (Optional)</label>
                  <textarea [(ngModel)]="content.pictureDescription.instruction" name="picInstruction" rows="2"
                    placeholder="e.g., Look at the picture and describe what you see"></textarea>
                </div>

                <div class="pictures-section">
                  <label>Pictures *</label>
                  <div *ngFor="let picture of content.pictureDescription.pictures; let i = index" class="picture-item">
                    <div class="picture-header">
                      <span class="picture-number">Picture {{i + 1}}</span>
                      <button type="button" (click)="removePicture(i)" class="btn-remove">√ó</button>
                    </div>
                    <div class="picture-fields">
                      <input type="text" [(ngModel)]="picture.imageUrl" [name]="'imageUrl_' + i" placeholder="Image URL" required />
                      <textarea [(ngModel)]="picture.prompt" [name]="'prompt_' + i" rows="2" placeholder="Prompt" required></textarea>
                      <input type="text" [(ngModel)]="picture.vocabularyHints" [name]="'vocab_' + i"
                        placeholder="Vocabulary hints (comma-separated)" />
                    </div>
                  </div>
                  <button type="button" (click)="addPicture()" class="btn-add">+ Add Picture</button>
                </div>
              </div>

              <!-- Virtual Conversation Content -->
              <div *ngIf="newPractice.type === 'virtual_conversation'" class="content-fields">
                <div class="form-group">
                  <label>Instruction (Optional)</label>
                  <textarea [(ngModel)]="content.conversation.instruction" name="convInstruction" rows="2"
                    placeholder="e.g., Have a conversation with the character"></textarea>
                </div>

                <div class="character-section">
                  <h4>Character Information</h4>
                  <div class="form-group">
                    <label>Character Name *</label>
                    <input type="text" [(ngModel)]="content.conversation.character.name" name="charName" placeholder="e.g., Alex" required />
                  </div>
                  <div class="form-group">
                    <label>Avatar (Emoji) *</label>
                    <input type="text" [(ngModel)]="content.conversation.character.avatar" name="charAvatar" placeholder="e.g., üë¶" required />
                  </div>
                  <div class="form-group">
                    <label>Character Bio *</label>
                    <textarea [(ngModel)]="content.conversation.character.bio" name="charBio" rows="2"
                      placeholder="e.g., A friendly student who loves sports" required></textarea>
                  </div>
                </div>

                <div class="form-group">
                  <label>Conversation Topic *</label>
                  <input type="text" [(ngModel)]="content.conversation.topic" name="convTopic" placeholder="e.g., Hobbies and Interests" required />
                </div>

                <div class="prompts-section">
                  <label>Conversation Prompts *</label>
                  <div *ngFor="let prompt of content.conversation.prompts; let i = index" class="prompt-item">
                    <input type="text" [(ngModel)]="content.conversation.prompts[i]" [name]="'prompt_' + i" placeholder="Prompt" required />
                    <button type="button" (click)="removeConversationPrompt(i)" class="btn-remove-small">√ó</button>
                  </div>
                  <button type="button" (click)="addConversationPrompt()" class="btn-add">+ Add Prompt</button>
                </div>
              </div>

              <!-- Role Play Content -->
              <div *ngIf="newPractice.type === 'role_play'" class="content-fields">
                <div class="form-group">
                  <label>Instruction (Optional)</label>
                  <textarea [(ngModel)]="content.rolePlay.instruction" name="roleInstruction" rows="2"
                    placeholder="e.g., Act out the scenario with your partner"></textarea>
                </div>

                <div class="scenarios-section">
                  <label>Scenarios *</label>
                  <div *ngFor="let scenario of content.rolePlay.scenarios; let i = index" class="scenario-item">
                    <div class="scenario-header">
                      <span class="scenario-number">Scenario {{i + 1}}</span>
                      <button type="button" (click)="removeScenario(i)" class="btn-remove">√ó</button>
                    </div>
                    <div class="scenario-fields">
                      <input type="text" [(ngModel)]="scenario.title" [name]="'scenarioTitle_' + i" placeholder="Scenario Title" required />
                      <textarea [(ngModel)]="scenario.description" [name]="'scenarioDesc_' + i" rows="2" placeholder="Description" required></textarea>

                      <div class="characters-subsection">
                        <label>Characters</label>
                        <div *ngFor="let char of scenario.characters; let j = index" class="character-item-small">
                          <input type="text" [(ngModel)]="char.name" [name]="'charName_' + i + '_' + j" placeholder="Name" required />
                          <input type="text" [(ngModel)]="char.role" [name]="'charRole_' + i + '_' + j" placeholder="Role" required />
                          <button type="button" (click)="removeScenarioCharacter(i, j)" class="btn-remove-small">√ó</button>
                        </div>
                        <button type="button" (click)="addScenarioCharacter(i)" class="btn-add-small">+ Character</button>
                      </div>

                      <div class="prompts-subsection">
                        <label>Dialogue Prompts</label>
                        <div *ngFor="let prompt of scenario.dialoguePrompts; let j = index" class="prompt-item-small">
                          <input type="text" [(ngModel)]="scenario.dialoguePrompts[j]" [name]="'dialoguePrompt_' + i + '_' + j" placeholder="Prompt" />
                          <button type="button" (click)="removeDialoguePrompt(i, j)" class="btn-remove-small">√ó</button>
                        </div>
                        <button type="button" (click)="addDialoguePrompt(i)" class="btn-add-small">+ Prompt</button>
                      </div>
                    </div>
                  </div>
                  <button type="button" (click)="addScenario()" class="btn-add">+ Add Scenario</button>
                </div>
              </div>

              <!-- Story Creation Content -->
              <div *ngIf="newPractice.type === 'story_creation'" class="content-fields">
                <div class="form-group">
                  <label>Instruction (Optional)</label>
                  <textarea [(ngModel)]="content.storyCreation.instruction" name="storyInstruction" rows="2"
                    placeholder="e.g., Create your own story using the vocabulary words"></textarea>
                </div>

                <div class="form-group">
                  <label>Theme *</label>
                  <input type="text" [(ngModel)]="content.storyCreation.theme" name="storyTheme" placeholder="e.g., Adventure" required />
                </div>

                <div class="form-group">
                  <label>Story Starter (Optional)</label>
                  <textarea [(ngModel)]="content.storyCreation.storyStarter" name="storyStarter" rows="2"
                    placeholder="e.g., Once upon a time, in a faraway land..."></textarea>
                </div>

                <div class="form-group">
                  <label>Vocabulary Words (comma-separated)</label>
                  <input type="text" [(ngModel)]="content.storyCreation.vocabularyWords" name="storyVocab"
                    placeholder="e.g., adventure, forest, treasure" />
                </div>

                <div class="form-group">
                  <label>Image Prompts (URLs, comma-separated)</label>
                  <input type="text" [(ngModel)]="content.storyCreation.imagePrompts" name="storyImages"
                    placeholder="Image URLs" />
                </div>

                <div class="guiding-questions-section">
                  <label>Guiding Questions</label>
                  <div *ngFor="let question of content.storyCreation.guidingQuestions; let i = index" class="question-item">
                    <input type="text" [(ngModel)]="content.storyCreation.guidingQuestions[i]" [name]="'question_' + i" placeholder="Question" />
                    <button type="button" (click)="removeGuidingQuestion(i)" class="btn-remove-small">√ó</button>
                  </div>
                  <button type="button" (click)="addGuidingQuestion()" class="btn-add">+ Add Question</button>
                </div>
              </div>

              <!-- Singing & Chanting Content -->
              <div *ngIf="newPractice.type === 'singing_chanting'" class="content-fields">
                <div class="form-group">
                  <label>Instruction (Optional)</label>
                  <textarea [(ngModel)]="content.singingChanting.instruction" name="singInstruction" rows="2"
                    placeholder="e.g., Sing along and follow the rhythm"></textarea>
                </div>

                <div class="form-group">
                  <label>Song/Chant Title *</label>
                  <input type="text" [(ngModel)]="content.singingChanting.title" name="songTitle" placeholder="e.g., Twinkle Twinkle Little Star" required />
                </div>

                <div class="form-group">
                  <label>Audio URL (Optional)</label>
                  <input type="text" [(ngModel)]="content.singingChanting.audioUrl" name="songAudio" placeholder="Audio file URL" />
                </div>

                <div class="form-group">
                  <label>Rhythm Pattern (Optional)</label>
                  <input type="text" [(ngModel)]="content.singingChanting.rhythmPattern" name="songRhythm"
                    placeholder="e.g., 4/4 time, steady beat" />
                </div>

                <div class="lyrics-section">
                  <label>Lyrics *</label>
                  <div *ngFor="let line of content.singingChanting.lyrics; let i = index" class="lyric-item">
                    <textarea [(ngModel)]="content.singingChanting.lyrics[i]" [name]="'lyric_' + i" rows="1" placeholder="Lyric line" required></textarea>
                    <button type="button" (click)="removeLyricLine(i)" class="btn-remove-small">√ó</button>
                  </div>
                  <button type="button" (click)="addLyricLine()" class="btn-add">+ Add Line</button>
                </div>

                <div class="actions-section">
                  <label>Actions (Optional)</label>
                  <div *ngFor="let action of content.singingChanting.actions; let i = index" class="action-item">
                    <input type="text" [(ngModel)]="content.singingChanting.actions[i]" [name]="'action_' + i" placeholder="Action description" />
                    <button type="button" (click)="removeAction(i)" class="btn-remove-small">√ó</button>
                  </div>
                  <button type="button" (click)="addAction()" class="btn-add">+ Add Action</button>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Assign To</label>
              <div class="student-selection">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="assignToAll" name="assignToAll" (change)="toggleAssignAll()" />
                  All Students
                </label>
                <div *ngIf="!assignToAll" class="student-list-selector">
                  <div *ngFor="let student of students" class="checkbox-label">
                    <input type="checkbox" [checked]="isStudentSelected(student.id)" (change)="toggleStudent(student.id)" />
                    {{ student.firstName }} {{ student.lastName }} (Grade {{ student.grade }})
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="createError" class="error-message">{{ createError }}</div>
            <div *ngIf="createSuccess" class="success-message">{{ createSuccess }}</div>

            <button type="submit" class="btn-create" [disabled]="isCreating">
              {{ isCreating ? 'Creating...' : 'Create Practice' }}
            </button>
          </form>
        </div>

        <!-- Right: Existing Practices -->
        <div class="practices-section">
          <h2>My Custom Practices</h2>

          <div *ngIf="isLoadingPractices" class="loading">Loading...</div>

          <div *ngIf="!isLoadingPractices && customPractices.length === 0" class="empty-state">
            No custom practices yet. Create one to get started!
          </div>

          <div *ngIf="!isLoadingPractices && customPractices.length > 0" class="practices-list">
            <div *ngFor="let practice of customPractices" class="practice-card">
              <div class="practice-header">
                <h3>{{ practice.activity.title }}</h3>
                <button (click)="deletePractice(practice.activity.id)" class="btn-delete" title="Delete">üóëÔ∏è</button>
              </div>
              <p class="practice-description">{{ practice.activity.description }}</p>
              <div class="practice-meta">
                <span class="badge">{{ formatType(practice.activity.type) }}</span>
                <span class="badge">{{ formatDifficulty(practice.activity.difficulty) }}</span>
                <span class="badge">{{ formatSkillArea(practice.activity.skillArea) }}</span>
              </div>
              <div class="practice-stats">
                <div class="stat-item">
                  <strong>{{ practice.activity.pointsReward }}</strong> pts
                </div>
                <div class="stat-item">
                  <strong>{{ practice.totalAssigned }}</strong> students
                </div>
                <div class="stat-item">
                  Level <strong>{{ practice.activity.minLevel }}</strong>
                  <span *ngIf="practice.activity.maxLevel">- {{ practice.activity.maxLevel }}</span>
                </div>
              </div>
              <details class="assigned-students">
                <summary>View assigned students ({{ practice.totalAssigned }})</summary>
                <ul>
                  <li *ngFor="let student of practice.assignedStudents">
                    {{ student.name }}
                  </li>
                </ul>
              </details>
            </div>
          </div>
        </div>
      </div>
    </div>
